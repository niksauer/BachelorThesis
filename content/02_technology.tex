%!TEX root = ../main.tex

\chapter{Theoretical Framework}
\label{chp:theoreticalFramework}

\section{Deposit-Refund System for Bottled Beverages in Germany}
\subsection{Legal Basis}
\label{sec:legalBasis}
Anticipating the depletion of capacity in disposal sites and due to the considerable share in waste generated by packaging \footnote{Recycling rate of packaging was below 50\% in the early 1990s (20\% for aluminium and plastic) \hide{\cite{GVM2010}} \cite[p.~2]{Hartlep2011Recycling}.} \cite[p.~2]{Hartlep2011Recycling}, German federal government enacted an ordinance regarding the avoidance of packaging waste (\textit{Verordnung über die Vermeidung von Verpackungsabfällen}, short: \textit{\ac{VerpackV}}) in 1991 which stipulates that packaging \cite[§~1]{verpackV1991}:

\begin{itemize}
  \item must be minimised to an extent necessary for protection and marketing of goods
  \item must be reused where possible
  \item must be recycled if reuse is not applicable 
\end{itemize}

These objectives were supported by introducing the:

\begin{description}[format={\storedescriptionlabel}]
	\item[Obligation to take back packaging]
	\hfill \\
	Producers and distributors of packaging are obliged to take back packaging free of charge, restricted to those goods of type, shape, size and material found within their stock \cite[§§~4-6]{verpackV1991}. Distributors with a retail area of less than 200$m^2$ are further exempted to the same brands. This duty may be only be ignored if a distributor participates in a system which ensures the periodical collection of waste \cite[§~6]{verpackV1991}, known and implemented as a refuse recycling system (\textit{duales System}) in 1990 \cite[p.~3]{Hartlep2011Recycling}.
	\item[Obligation to levy deposits on \gls{beverage packaging}\label{itm:levyDepositObligation}] \footnote{Information regarding the presumed effects and critique thereof can be found in \cite[p.~630]{Cora2000} and \cite{wacker2008pflichtpfand}.}
	\hfill \\
	A deposit is to be charged by the distributor that will be refunded to the purchaser upon return of the bottle. This duty is applicable on all levels of trade involving domestic beverages sold in non-\gls{reusable packaging} (\textit{one-way packaging}) \cite[§~7]{verpackV1991} and becomes effective as soon as the quote of reusable beverage packaging falls below 72\% \footnote{Aggregated quote derived from weighted average of percentages of reusable packaging encountered across individual segments in 1990 \cite[§~9]{verpackV1991} \cite[p.~134]{Rummler/Schutt1991}} \cite[§~9]{verpackV1991}.
\end{description}

\begin{figure}[hbt]
	\centering
	\begin{tikzpicture}
        \begin{axis}[
%            xlabel = Lines to process (\#),
%            ylabel = Execution time (seconds),
			xtick = data,
			xticklabels={1991, , , 1994, , , 1997, , , 2000, , , 2003, , , 2006, , , 2009, 2011, 2013},
			height = 8cm,
            width =\textwidth,
%            legend pos = north west,
%            title = {File Processing Speeds~\footnotemark}
			xmin=0,
			xmax=24,
		]
	
        \addplot+[sharp plot, color=blue]
            coordinates {
                (1, 71.69) (2, 73.54) (3, 73.55) (4, 72.87) (5, 72.27) (6, 72.21) (7, 71.33)
                (8, 70.13) (9, 68.68) (10, 64.98)
                (11, 61.13) (12, 56.2) (13, 63.6) (14, 60.33) (15, 55.99) (16, 50.64)
                (17, 46.44) (18, 44.74) (19, 44.33) (21, 42.31) (23, 40.8)
                
%				statista dataset                
%                (20, 48) (21, 48) (22, 45.7) (23, 45.1) (24, 45.1) (25, 44.3) 
            };
        
        \addplot[mark=none, thick, red, domain=0.5:9.5] {72};
        
		\end{axis}
	\end{tikzpicture}
  	\caption{Aggregated quote of reusable beverage packaging (in \%) between 1991 and 2013 \cite[p.~1]{BMU2015} \hide{\cite{statista2015Mehrweg}}}
  	\label{fig:reusableQuoteDevelopment}
\end{figure}

Starting in 1997, the threshold to levy deposits has been surpassed steadily (comp. \autoref{fig:reusableQuoteDevelopment}), requiring an additional assessment of the situation to ensure that the fluctuation does not represent a short-term development \cite[§ 9]{verpackV1991} \cite[p.~5]{Hartlep2011Recycling}. Although obvious at glance, the outcome of a compulsory deposit-refund system only became official on July 2\textsuperscript{nd}, 2002 \cite[p.~49]{Geyer/Smoltczyk2003}, after a lawsuit lead by multiple bottlers and distributors had delayed the initial announcement \cite{spon2011handel}. Introduction of this mandatory system was scheduled for Jan 1\textsuperscript{st}, 2003 \cite[p.~53]{Geyer/Smoltczyk2003}.

\subsection{Amendments}
The German packaging ordinance underwent several revisions, including a change of title to highlight the importance of recycling \cite{verpackV1998}. In the following, the most important changes affecting the current state (see \autoref{fig:depositCriteria}) shall be highlighted.

\begin{description}
	\item[1998]
	\hfill \\
	Trims deposit obligation to those beverages for which the quote of reusable packaging has fallen when compared to 1991, though still necessitates that overall aggregated quote undercuts threshold of 72\% \cite[pp.~142]{Flanderka1999}. Even though all five segments (beer, mineral water, carbonated soft drinks, fruit juice/non-carbonated soft drinks and wine) have failed this comparison \cite[p.~1]{BMU2015}, juices/non-carbonated soft drinks and wine are exempted because their decline and market volume has not been regarded significant enough to justify the costs introduced with such a system \hide{\cite[pp.~1]{BMU 2002}} \cite[pp.~6,~9]{Hartlep2011Recycling}. 
	
\todo[inline]{figure / table showcasing development of reusable packing quote in each segment (appendix)}

	\item[2005]
	\hfill \\
	Reduces different deposit classifications to single deposit worth \EUR{0.25} valid for all applicable beverages with a filling volume between 0.1 - 3.0 litres. Furthermore, \gls{ecologically advantageous packaging} is admitted the same treatment and classification as that of reusable packaging which represents an important shift of thought since the sole utilisation of packaging has been considered inferior to its reuse with regard to all ecological aspects \hide{\cite[p.~1]{BMU 2010c}} \cite[p.~7]{Hartlep2011Recycling}. Accordingly, the new goal is to promote the use of ecologically advantageous packaging with a target of 80\% market dominance \cite[§~1]{verpackV2008}. This amendment also adds non-carbonated soft drinks and mixed alcoholic drinks to the list of beverages subject to deposits (irrespective of the reusable packaging quote experienced) while simultaneously protecting dietary products from deposits \cite[p.~1408]{verpackV2005} \cite[p.~171]{Flanderka/Stroetmann2009}. Finally, retailers are required to take back any bottles made from a beverage packaging material (glas, metal, paper and plastic) also sold by that store (brand equality for retail areas of less than 200$m^2$ still applies) \hide{\cite[p.~1]{BMU 2010c}}\hide{\cite[p.~7]{BMU 2010b}} \cite[p.~11]{Hartlep2011Recycling}. Previously, return had been limited to bottles of same shape, size [..] and type (comp. \ref{sec:legalBasis}). This regulation attempts to stop isolated deposit-refund systems which arose because discounters created their own specially shaped bottles \cite[p.~168]{Flanderka/Stroetmann2009}. To conform with this change, industry and commerce established the \acl{DPG}, responsible for setting up a nationwide deposit-refund system \hide{\cite[p.~1]{BMU 2010c}} \cite[p.~8]{Hartlep2011Recycling}.
	
	\item[2008]
	\hfill \\
	Orders distributors to clearly mark bottles as being obliged to a deposit. Further, distributors are demanded to participate in a nationwide deposit-refund system to enable the mutual settlement of claimed deposits \cite[§~9]{verpackV2008}. Lastly, the exemption for dietary products is reduced to infant nutrition. This acts as a measure to counteract increasingly false product declarations attempting to forego deposits \cite[pp.~531]{verpackV2008} \cite[p.~171]{Flanderka/Stroetmann2009}.
\end{description}

\todo[inline, color=orange]{add 2019 amendment}

\begin{figure}[hbt]
	\centering
	\includegraphics{images/theoretical_framework/one_way_packaged_beverages_deposit_criteria}
	\caption{Criteria to be considered for deposits (valid until Jan 1\textsuperscript{st}, 2019) \cite[p.~9]{Hartlep2011Recycling}}
	\label{fig:depositCriteria}
\end{figure}

\FloatBarrier

\subsection{Operation}

\subsubsection{Administration by \acl{DPG}}
\ac{VerpackV} simply assumes that a nationwide deposit-refund system will be installed by May 1\textsuperscript{st}, 2006 without further specifying its exact implementation details \cite[Art.~2]{verpackV2005} \cite[§~9]{verpackV2008}. Therefore, \ac{DPG} has been founded in 2005 to ensure the definition of a standards framework, which includes IT-processes, APIs and a universal security mark identifying one-way packaged bottles on which a deposit is paid (\textit{returnable bottle}). Other tasks concern the management of contracts, certifications and maintenance of a centralised database which stores information about products, participants and reverse vending machines \cite[pp.~13]{Hartlep2011Recycling}\hide{\cite[pp.~96]{DPG/Roland Berger 2010}}. However, \ac{DPG} does not have access to purchasing data (e.g. number of sold and returned bottles or total amount of reimbursed deposits). This data is only exchanged between actors of the deposit-refund cycle. Consequently, \ac{DPG} is not involved in the process of settling refund claims between take-back points and does not act as a central clearing house. It is exclusively responsible for providing a contractual and administrative basis needed to enable such a system \cite[p.~14]{Hartlep2011Recycling}.

\todo[inline]{figure showcasing universal security mark (appendix)}

\subsubsection{Roles}
As indicated, actors of the deposit-refund cycle (e.g. retailer selling returnable bottles) must register with \ac{DPG}, accept the contractual basis for the role to be exercised and pay a yearly membership fee in order to participate\hide{\cite[p.~15]{Hartlep2011Recycling}}\hide{\cite[p.~34]{DPG/Roland Berger 2010}}. The most important roles are \hide{\cite[pp.~33-34]{DPG/Roland Berger 2010}} \cite[pp.~15-16]{Hartlep2011Recycling}:   

\begin{description}
	\item[Initial distributor]
	\hfill \\
	Puts returnable bottle into circulation. Inherently tied to role of deposit escrow account manager. Must pay a one-time fee to register a beverage (i.e. an \acs{EAN}) with \ac{DPG}'s central database. This fee depends on the number of pieces produced within a year for that beverage.
%	Commonly exercised by bottler or importer but may also include retailers selling their own brands.
	\item[Deposit escrow account manager]
	\hfill \\
	Administrates and disburses money received from levying deposit on returnable bottle. Task may be delegated to a service provider.
	\item[Take-back point]
	\hfill \\
	Refunds consumer in exchange for returning bottles subject to deposits. Inherently tied to role of refund claimant.
	\item[Refund claimant]
	\hfill \\
	Puts in a claim to be reimbursed for making advance refunds. Task may be delegated to a service provider.
	\item[Counting center operator]
	\hfill \\
	Takes over role of reverse vending machine by confirming number of genuinely accepted bottles with a receipt. 
	
\end{description}

\subsubsection{Deposit-Refund Cycle}
\label{sec:depositRefundCycle}
Each buyer of a returnable bottle must directly pay the designated deposit to the seller. This process starts with the initial distributor (step 1 of \autoref{fig:depositRefundCycle}) and is repeated for each sub-distributor until the bottles reaches a retailer which acts as the final distributor to end consumers (step 2 of \autoref{fig:depositRefundCycle}). After consumption, the consumer may return the packaging at any retail store obliged to take back the packaging in question (take-back point) (step 3 of \autoref{fig:depositRefundCycle}). Return may be performed manually (step 1a of \autoref{fig:clearingProcess}) or can be automated through reverse vending machines (step 1b of \autoref{fig:clearingProcess}). The former requires personnel to count the number of returned bottles and refund the consumer accordingly. Following count, the collected bottles must be shipped to a counting center which is responsible for digitally capturing each bottle (step 2a of \autoref{fig:clearingProcess})\hide{\cite[p.~76]{DPG/Roland Berger 2010}}\hide{\cite[p.~17]{Hartlep2011Recycling}}. At last, the bottles will be compressed to eliminate the possibility of repeated refunds\hide{\cite[p.~77]{DPG/Roland Berger 2010}}. In the case of reverse vending machines, the process of counting, capturing and compressing bottles can take place locally at a retail store (step 2b of \autoref{fig:clearingProcess})\hide{\cite[p.~76]{DPG/Roland Berger 2010}}. Alternatively, retailers are permitted to return the packaging to the previous distributor, thereby unwinding the deposit-refund chain. However, this practice is rarely exercised since the packaging will not be reused and transportation would only induce additional ecological and financial strain\hide{\cite[p.~17]{Hartlep2011Recycling}}. Instead, the compressed packaging can be sold directly to recycling companies (step 3 of \autoref{fig:clearingProcess}) \cite[p.~16-17]{Hartlep2011Recycling} \cite{reiling}.  

\begin{figure}[hbt]
  \centering
  \includegraphics{images/theoretical_framework/deposit_cycle_current_short}
  \caption{Deposit-refund cycle \cite[p.~14]{Hartlep2011Recycling}}
  \label{fig:depositRefundCycle}
\end{figure}

Since take-back points refund consumers independent of a bottle’s purchasing location, a settlement process (\textit{clearing}) is required to reimburse retailers for making advance refunds (step 4 of \autoref{fig:depositRefundCycle}). This clearing happens by issuing a refund invoice to the initial distributor who can use the deposits originally collected the pay the bill (step 4 of \autoref{fig:clearingProcess}). Ideally, all accounts are in balance, meaning that all packaging has been returned. Otherwise, a surplus on the part of an initial distributor is to be experienced \cite[p.~17]{Hartlep2011Recycling}.

\begin{figure}[hbt]
	\centering
  	\includegraphics{images/theoretical_framework/bottle_return_current}
  	\caption{Clearing process for manual and automated bottle returns \cite[p.~18]{Hartlep2011Recycling}}
  	\label{fig:clearingProcess}
\end{figure}

Refund invoices must also include data representing the number of bottles for which a refund was issued. This data originates from the return process in which each bottle is eventually captured. Capture refers to both validating the universal security mark printed on a bottle’s label as well as extracting the \ac{EAN} by scanning its barcode. By outfitting reverse vending machines with a network connection, looking up the \ac{EAN} in question becomes possible, thus ensuring that a deposit for the bottle has been collected beforehand\hide{\cite[pp.~2]{Wincor Nixdorf 2010}}. For each valid bottle, a signed record is then produced and stored on the machine\hide{\cite[p.~18]{Hartlep2011Recycling}}. This data must be retrieved and transmitted within one week\hide{\cite[p.~90]{DPG/Roland Berger 2010}}. Likewise, retailers receive a similar dataset when relying on a counting center\hide{\cite[p.~18]{Hartlep2011Recycling}}. Finally, any transmitted data is anonymised by removing the return location and summing up the refunds for each \ac{EAN} captured\hide{\cite[pp.~90]{DPG/Roland Berger 2010}}. Initial distributors must pay the invoice within ten business days or five-teen calendar days at the lastet \hide{\cite[p.~40]{DPG/Roland Berger 2010}} \cite[p.~18-19]{Hartlep2011Recycling}.

An extended diagrammatical overview of this cycle can be found in the appendix \autoref{appendix:theoreticalFramework} on \autopageref{fig:depositCycleCurrent}. It includes the various scenarios encountered nowadays which lead to differently balanced accounting states, as indicated previously. Also, the process of buying a returnable bottle from the perspective of a whole-seller or any other special entity such as a caterer is reflected in both figures since these parties are ultimately responsible for returning the one-way bottle as long as it has not been further distributed and by such, should be regarded as a consumer.

\todo[inline, color=orange]{explain situation surrounding deposits on reusable bottles?}

\pagebreak

\section{Decentralized Applications}

\subsection{History \& Raison d'Être}
\label{dAppHistory}
Johnston's Law states that everything that can be decentralised, will be decentralised \cite{JohnstonsLaw}. Fittingly, a new model for building massively scalable, successful and profitable applications, known as \textit{\acp{dApp}}, is emerging \cite[p.~5]{Raval.2016} \cite[pp.~1-2]{Johnston2015}, suggesting that this will also become the fate of the vast majority of web software applications as those follow a centralized server-client model in which individuals directly depend on a central power to send and receive information \cite[pp.~7-8]{Raval.2016}. 

The architectural structure embodied by the Web has not always been as pronounced as is these days. In its early days, people would host personal servers for others to connect to and everyone owned their data. But soon, it was recognised that one individual or group could pay for the maintenance of a server and profit from users that utilize it (e.g.~Amazon Web Services \footnote{Amazon controls roughly 40\% of the cloud market and serves customers like AirBnb, Expedia, Netflix, Slack and Spotify \cite{Verge2018}. Please install \cite{fuckOffAWS}, to experience the impact of an AWS downtime.}) and since this was easier to the average user, both conceptually and programmatically, the transition to few centralized controlling entities started \cite[pp.~14]{Raval.2016}. 

Now, users willingly give their data to service providers in return for free usage, trusting them to not misuse or sell the data elsewhere \cite[p.~24]{Raval.2016}. However, Snowden proved that this trust can, has and will be broken as long as we entrust (encrypted) data to central entities which represent a surveillance state's dream \cite{Guardian2013} \cite[p.~25]{Raval.2016}. In addition, centralized infrastructure and services increase the chances for downtime, censorship and \gls{counterparty risk} \cite[p.~23]{Antonopoulos.2018}. Drawbacks like these have attributed to the development of \acp{dApp}, first fully realized by Bitcoin \footnote{BitTorrent, as an earlier example, depends on centralized trackers for data discovery \cite[p.~26]{Raval.2016}.} as a currency \cite[p.~1]{Johnston2015} \cite[p.~1]{bitcoin}. Simultaneously, recent apps (e.g.~Uber and AirBnb) attempt to decentralize real world parts of a business by providing a central and trusted data store, foreshadowing the development of decentralized apps beyond pure finances \footnote{Supports the blockchain evolution theorem proposed in \cite{Swan.2015}.} \cite[p.~15]{Raval.2016}.

The concept of \acp{dApp} is meant to take the web to its next \footnote{Web 2.0 describes the evolution towards user-generated content, responsive interfaces and interactivity \cite[p.~34]{Antonopoulos.2018}.} natural evolution \cite[pp.~34]{Antonopoulos.2018}. Web3 represents the vision of a serverless \footnote{Not to be confused with the centralized Function-as-a-Service offerings detailed in \cite{serverlessComputing}.} internet, encouraging applications to incorporate decentralised protocols in order to put users in control of their own data, identity and destiny \cite{web3}. As global economy evolves, data will become the primary form of value \cite[p.~25]{Raval.2016}, leading \citeauthor{Raval.2016} to believe that:

\begin{quote}
  "[\acp{dApp}] will someday become more widely used than the world's most popular web apps." \cite[p.~5]{Raval.2016}
\end{quote}

\subsection{Definition}
Developers have different opinions on what exactly a \ac{dApp} is or which components constitute it. Some think that no central point of failure is all it takes, whereas others name more specific requirements \cite[p.~9]{Raval.2016}. The following will chronologically examine the various definitions available in order to derive one used for the remainder of this thesis. 

\subsubsection{\citeyear{EthereumWhitepaper}}
\citeauthor{EthereumWhitepaper} introduces the concept of a \ac{dApp} as part of Ethereum's white paper. A complete \ac{dApp} should consist of:

\begin{itemize}
  \item low-level business-logic components
  \item high-level graphical user interface components
\end{itemize}

He goes on to state that "the blockchain and other decentralized protocols will serve as a complete replacement for the server for the purpose of handling user-initiated requests. ... Decentralized protocols ... may be used to store the web pages themselves." \cite[p.~34]{EthereumWhitepaper}. 

This vague explanation is expanded through a consequent blog post (\citeyear{Buterin2014}) in which \citeauthor{Buterin2014} formally defines the concept as being a superset of \textit{smart-contracts} \cite{Buterin2014}:

\begin{description}
	\item[Smart-contract]
	\hfill \\
	Mechanism involving digital assets and a fixed number of parties, where some or all of the parties put assets in and assets are automatically redistributed among those parties according to a formula based on certain data that is not known at the time the contract is initiated.
	\item[Decentralized application]
	\hfill \\
	Similar to a smart-contract but with unbounded number of participants and not necessarily of financial nature.
\end{description}

\subsubsection{\citeyear{Johnston2015}}
To be considered a \ac{dApp}, \citeauthor{Johnston2015} assume that an application \cite[p.~2]{Johnston2015}:

\begin{itemize}
  \item is \textbf{open-source}, operates autonomously and adapts its protocol with user consent 
  \item stores its data and records of operation in a \textbf{public blockchain}
  \item uses a \textbf{token} necessary for accessing it and rewarding contribution of value
  \item generates its tokens according to a predefined \textbf{cryptographic algorithm}
\end{itemize}

Moreover, he classifies \acp{dApp} based on whether they have their own blockchain (Type~I), use that of another \ac{dApp} (Type~II) or use a Type~II \ac{dApp} as its underlying protocol (Type~III). The latter is also known as a protocol \cite[pp.~3-4]{Johnston2015}.

\subsubsection{\citeyear{Raval.2016}}
Although similar to the elements proposed priorly, the definition given in \citetitle{Raval.2016} highlights their importance and by such requires that a profitable \ac{dApp} \cite[pp.~9-14]{Raval.2016}:
 
 \begin{itemize}
  \item is \textbf{open-source} to achieve transparency and gain trust among users 
  \item achieves \textbf{decentralized consensus} on application-level constructs (e.g. high-score)
  \item uses an \textbf{internal currency} for access, reward and monetisation
  \item has \textbf{no central point of failure} so that it cannot be shut down
\end{itemize}

\subsubsection{\citeyear{Antonopoulos.2018}}
Finally, \citeauthor{Antonopoulos.2018} (co-founder of Ethereum) back up and clarify \citeauthor{EthereumWhitepaper}'s design guidelines by stating that a \ac{dApp} is composed of at least \cite[p.~34]{Antonopoulos.2018}:

\begin{itemize}
  \item \textbf{smart-contracts} on a \textbf{blockchain}
  \item a web frontend \textbf{user interface}
\end{itemize}

Optionally, a \ac{dApp} may rely on other decentralized components such as:

\begin{itemize}
  \item decentralized storage
  \item decentralized messaging
\end{itemize}

%\subsubsection{Derived Classification}
%\begin{description}[format={\storedescriptionlabel}]
%	\item[Type I]
%	\hfill \\	
%\item[Type II]
%	\hfill \\		
%\end{description}

\todo[inline, color=orange]{explain that classification has been slimmed down to Type I \& II dApps}

\subsubsection{Derived Definition}
An application is considered to be a \acf{dApp} if it exhibits all of the characteristic features marked as a \textit{must}. Secondary or recommended traits are labelled as \textit{can} or \textit{should} respectively.

\begin{description}[format={\storedescriptionlabel}]
	\item[Open-source]
	\hfill \\	
	Traditional business models require the service for sale to be better than that of a competitor. By open-sourcing a solution (both frontend and backend), copying becomes inevitable \cite[p.~10]{Raval.2016}. However, users will want to remain with the team that is best suited to maintain the application \cite[p.~11]{Raval.2016}. Therefore, developers should not fear trading secrecy for transparency. Transparency removes a barrier to adoption as users are no longer required to trust that an application works as advertised \cite[p.~9]{Raval.2016}. Additionally, open-source development often sparks the attraction of enthusiastic developers who contribute freely \cite[p.~11]{Raval.2016}.
	
	\begin{itemize}
  		\item \textit{must} be deployed visibly (i.e. the executed code can be inspected by a user)
  		\item \textit{should} be developed on an open-source platform
	\end{itemize}
	
	\citeauthor{Johnston2015} call for an application to only alter its protocol by the consensus of its users. Yet, it can be argued that this does not represent a core property of a \ac{dApp} since users can revert to the desired state at any time by forking the project.

	\begin{itemize}
  		\item \textit{can} require the consensus of users to upgrade its protocol
	\end{itemize}

	\item[Decentralized \label{decentralizedConsensus} consensus]
	\hfill \\
	Usually, application-level constructs (e.g. usernames, high-scores or status updates) are managed and modified only through the centralized application provider, thereby ensuring a single and consistent state (\textit{singleton}). Luckily, blockchains provide the means to reach consensus in a decentralized manner. Traditionally, this is only applied to transactional logs \cite[p.~1]{bitcoin}. Extending this consensus mechanism to cover the outcome of a computer program and consequently storing the result on a blockchain for future retrieval as an input, would enable virtually any application. Seeing that such an application would always have a single globally valid state, the underlying infrastructure can be colloquially termed a world-computer.
	
	\citeauthor{Raval.2016}, \citeauthor{Antonopoulos.2018}, refer to these programs as smart-contracts and equally expect them to be secured by and executed on a blockchain \cite[p.~13]{Raval.2016} \cite[pp.~23,~34]{Antonopoulos.2018}. It must be noted that \citeauthor{Buterin2014} consistently denotes smart-contracts as being a subset of contracts. The former is of financial nature and may involve redistributing digital assets among parties or unlocking value depending on the conditions met \cite[pp.~1,~13]{EthereumWhitepaper}. The latter can be used to encode arbitrary state transition functions required to build decentralized applications which may also issue tokens \cite[pp.~1,~19]{EthereumWhitepaper}. For simplification purposes, the business logic of both applications types will be referred to as smart-contracts. 	

	\begin{itemize}
  		\item Type I \textit{must} achieve decentralized consensus on state-transitions
  		\item Type II \textit{can} only modify its data via a smart-contract
	\end{itemize}

	Finally, in order to achieve decentralized consensus, it is ultimately necessary to have a complete picture of the state-transitions (\textit{transactions}) which have been applied by a network. While theoretically possible, applications have never been observed to only store their transactions, due to the long processing needed to rebuild the most current state (\textit{data}). 
	
	\begin{itemize}
  		\item \textit{must} store its transactions in a public blockchain
  		\item \textit{should} store its data in a public blockchain
	\end{itemize}

	\item[Internal currency]
	\hfill \\
	According to \citeauthor{Raval.2016}, profit is a cornerstone of any successful, robust and sustainable application \cite[p.~9]{Raval.2016}. Because traditional revenue streams (e.g. fees, advertising, subscriptions) are not applicable without preventing the possibility of a fork, he proposes an internal currency \footnote{Type I: Blockchain-native cryptocurrency, Type II: Smart-contract-issued token.} that is required to use the service \cite[p.~11]{Raval.2016}, hoping that it will appreciate in value by being listed on an exchange. Nevertheless, not every application is designed for profit.
	
	\begin{itemize}
  		\item \textit{can} use an internal currency for monetisation
  		\item \textit{can} use an internal currency for access / service usage
	\end{itemize}
	
	On the other hand, using an internal currency to reward the contribution of value is especially important for Type I \acp{dApp} which employ their own blockchain and thus require an incentivization structure that keeps both miners and developers active \cite[p.~9]{Raval.2016}.
	
	\begin{itemize}
		\item Type I \textit{must} use an internal currency to reward the contribution of value
		\item Type II \textit{can} use an internal currency to reward the contribution of value
	\end{itemize}
	
	Lastly, \citeauthor{Johnston2015} specify that tokens shall only be generated according to a predefined cryptographic algorithm. This is inherently true for Type I \acp{dApp} which issue their internal currency as a reward for completing the cryptographic challenge (e.g.~proof-of-work) \cite[pp.~3-4]{bitcoin}. In this context, tokens are considered to be a feature of Type II \acp{dApp} (comp. \ref{decentralizedConsensus}). Therefore, their generation is not directly tied to cryptographic algorithms, but rather to the program's control flow.
	
	\begin{itemize}
		\item Type I \textit{must} use a cryptographic algorithm to generate its internal currency
		\item Type II \textit{can} only generate its internal currency via a smart-contract
	\end{itemize}
	
	\item[Decentralized protocols]
	\hfill \\
	Although often required, storing massive amounts of data in a blockchain defats its design purpose of a simple transactional log. Moreover, this would diminish the incentive to maintain the network because the cost to participate (i.e.~disk storage and bandwidth) will become considerably higher than the reward paid if many applications follow this trend. Hence, other solutions should provide methods for storing data in a decentralized way that is robust and as trust-less as possible \cite[pp.~25]{Raval.2016}.  
	
	\begin{itemize}
		\item \textit{can} use a decentralized storage solution
	\end{itemize}
	
	Similarly, message-intensive applications should not (entirely) rely on a blockchain for operation. This is due to the fact that every message will be stored forever and is public by default. 
	
	\begin{itemize}
		\item \textit{can} use a decentralized messaging solution
	\end{itemize}
	
	
\end{description}

The definition presented within this section purposely does not make any assumptions about the user interface or a \ac{dApp}'s resiliency. More importantly, the primary focus and goal of any \ac{dApp} developer should be to give users the confidence that a product works as promised by solely relying on open, decentralized peer-to-peer infrastructure services that can be inspected for functioning from end-to-end.

\todo[inline]{draw comparison to CLIs in respect to UI absence}

\todo[inline]{compare infrastructure model against traditional web apps to highlight open deployment}

%which can be maximised by employing additional decentralized protocols as outlined above

%in addition to prescribing that every \ac{dApp} must not have a central point of failure. 

%In this sense, any application that utilises smart-contracts as its business-logic determining the next state to be taken in response to a request will be considered a type II \ac{dApp}.

%The resulting architecture, compared to that of a traditional web application, is detailed in \autoref{fig:dAppArchitecture}. 
%
%\begin{figure}[hbt]
%	\centering
%  	\includegraphics{images/theoretical_framework/dApp_architecture}
%  	\caption{Infrastructure model comparison between traditional web application and \ac{dApp}}
%  	\label{fig:dAppArchitecture}
%\end{figure}
	
\subsection{Tokens}
By introducing a digital equivalent, blockchain has evoked a semantic change for the word token originally used to mean privately-issued coin-like items that have insignificant value and are designed for a single purpose (e.g. transportation-, arcade- or laundry tokens). Now, tokens are used to simultaneously convey ownership, access rights, as well as the right to vote, for instance. Moreover, they are more easily exchangeable, a pitfall commonly cited \cite[p.~173]{Antonopoulos.2018}. According to \citeauthor{Antonopoulos.2018}, this could make tokens quite valuable when used in a way that does not re-create the conditions that made physical tokens worthless \cite[p.~178]{Antonopoulos.2018}, hereby hoping for industry wide solutions. 

\subsubsection{Use Cases}
\citeauthor{Antonopoulos.2018} present the following list of possible uses. However, tokens often encompasses several of these features and, much like their physical equivalents, it is hard to discern between them (e.g. driving license as identity and attestation) \cite[pp.~173-174]{Antonopoulos.2018}.

\begin{AutoMultiColItemize}
  \item Currency
  \item Resource
  \item Asset
  \item Access
  \item Equity
  \item Voting
  \item Collectible
  \item Attestation
\end{AutoMultiColItemize}


Further, most projects employ tokens for two reasons: \textit{utility} and/or \textit{equity}. Similar to access tokens, utility tokens are those where the use of the token is required to pay for a service, application or resource \cite[p.~176]{Antonopoulos.2018}. Yet, this requirement increases the barriers to adoption as the risks of broader economy (e.g. exchanges, liquidity, regulators) are added to that of the underlying blockchain technology \cite[pp.~177]{Antonopoulos.2018}. Tokens should be adopted because the application cannot work without it, not because it presents a fast way to raise money while being disguised as a utility token to forego public securities regulations \cite[p.~178]{Antonopoulos.2018}.

\subsubsection{Fungibility}
Tokens are fungible if any single unit can be substituted for another without incurring a difference in value or function. A token is not entirely fungible if its historical provenance can be tracked, as this enables black- and whitelisting. The latter is the case for most cryptocurrencies \footnote{Monero pursues complete anonymity and therefore faces the possibility to be banned in Japan \cite{monero}.}. Lastly, non-fungible tokens represent unique tangible or intangible items which are not interchangeable \cite[p.~175]{Antonopoulos.2018}.

\subsubsection{Intrinsicality \& Counterparty Risk}
While some tokens represent blockchain-native digital items, many tokens are used to represent extrinsic things. By such, consensus rules do not entirely apply and human law or agreements decide whether the transfer of ownership through tokens will be recognised. It is therefore even more important to understand who possess the associated asset and know what formal rules apply \cite[pp.~175-176]{Antonopoulos.2018}. Leveraging tokens and smart-contracts to eliminate counterparty risk will most likely play part in fut
ure market strategies.

\pagebreak

\section{Ethereum}
\subsection{Overview}
In line with the web3's vision of a serverless internet (comp. \ref{dAppHistory}), Ethereum was designed to abstract the details of a blockchain to provide a deterministic and secure programming environment for decentralized applications in which developers  are no longer required to bootstrap the underlying mechanisms \cite[p.~27]{Antonopoulos.2018}. By such, it is practically regarded as an open-source, globally decentralized computing infrastructure that executes programs, known as smart-contracts, for which the current state and transitions leading to this state are stored in a blockchain alongside a cryptocurrency called Ether. However, it must be emphasised that Ether is primarily intended as a utility currency \footnote{Amusingly, Vitalik Buterin, co-founder of Ethereum, would like to use Bitcoin Cash for day-to-day transactions \cite{forbes2018}.} to meter and constrain resource usage during execution which stands in stark contrast with Bitcoin's sole purpose of being a digital payment network \cite[p.~23]{Antonopoulos.2018} \cite[p.~1]{bitcoin}.

Compared to a general purpose computer, the main differences are that \cite[p.~28]{Antonopoulos.2018}:

\begin{itemize}
  \item state changes are governed by rules of consensus
  \item state is distributed globally on a shared ledger
\end{itemize}

From a computer science perspective, Ethereum may therefore be described as a deterministic but practically unbounded state-machine characterised by its \cite[p.~23]{Antonopoulos.2018}: 

\begin{itemize}
  \item globally accessible singleton state
  \item virtual machine that applies changes to that state
\end{itemize}
 
%\hide{\footnote{Here: Program which is executed in the \acl{EVM} \cite[p.~57]{Antonopoulos.2018}. Can be generalised to refer to programs that change singleton state of globally accessible, unbounded state-machine (colloquially: world-computer) \cite[p.~23]{Antonopoulos.2018}.}}

%This is achieved by using the blockchain to synchronise and store the state 

%a tedious process when aiming for a secure and distributed network.

%, thereby launching yet another (potentially unsecured) blockchain.

%which should no longer be required to bootstrap the underlying 

% without having them bootstrap the underlying infrastructure and by such launching yet another blockchain.

%that go beyond digital currencies. 

%Ethereum is commonly described as being a word computer, meaning that its programs run everywhere but yet produce a common state 

\subsection{Developer Popularity \& Adoption}
Naturally, and as is the case with most base layer technologies, Ethereum does not represent the only smart-contract platform available \footnote{Contenders include (alphabetically listed): Cardano, Corda, EOS, Hyperledger Fabric, Lisk, NEM, NEO, Stratis and Waves.}. Nevertheless, several key figures support the claim of Ethereum dominating this space: 

\begin{itemize}
  \item 94 of top 100 tokens (i.e. \acp{dApp}) launched on Ethereum (87\% of top 800) \cite{coinmarketTop100Tokens} \cite{ethereumNetworkState}
  \item ranks well above competitors (\#33 vs. \#72 for EOS) when comparing traffic of dedicated sites in StackExchange network \cite{stackExchangeTechnology}
%  \item 1M MetaMask users (browser plug-in for lightweight blockchain connectivity) \cite{ethereumNetworkState}
\end{itemize}

Moreover, \citeauthor{10.1371/journal.pone.0169556} argue that upon emergence of a new, technically more advanced platform, the blockchain with a stronger development team and open-source community is more likely to succeed \cite[p.~14]{10.1371/journal.pone.0169556}. This developer and community focused nature is clearly seen within the Ethereum landscape:

\begin{itemize}
  \item StackExchange topic encounters mainly developer focused questions \cite[p.~6]{blockchainTechnologyGrowth}
  \item \textasciitilde 14.3k answered questions (vs. \textasciitilde 850 for EOS) [68\% vs. 81\% of total questions] \cite{stackExchangeTechnology}
  \item \textasciitilde17.5k repositories on GitHub (vs. \textasciitilde3.4k for EOS \& \textasciitilde2.5k for Hyperledger)  \footnote{A fuzzy, top-level search has been conducted on \href{https://github.com/search?q=ethereum}{GitHub} on August 15\textsuperscript{th}, 2018.}
%  \item 550k downloads of Truffle (development \& testing framework) \cite{ethereumNetworkState}
\end{itemize}

Most importantly, Ethereum is estimated to have around 250k developers \cite{ethereumNetworkState}, a 30-fold lead to Hyperledger Fabric, the second most active community, according to a report from Gartner \cite{bloomberg2017}. 

Similarly, the degree of decentralization should not be neglected when considering platforms based on public permissionless blockchains. To this extent, Ethereum boosts \textasciitilde17.6k nodes across six continents \footnote{EOS does not qualify since the 21 block producers used in its delegated proof-of-stake consensus mechanism are elected from a list of pre-approved candidates \cite[p.~6]{eosWhitepaper} \cite{eosBlockproducers}. A similar case can be made for NEO which is only currently in the process of decentralization \cite{neoDecentralization} \cite{neoConsensus}.} \cite{ethernodes}.  

%The scope of activity is also the best indicator of a cryptocurrency's market valuation \cite[p.~8]{10.1371/journal.pone.0169556}.   

% suggest that developer activity is the best indicator of a cryptocurrency's market valuation and 
%Moreover, developer activity is 

\subsection{Concepts}
In order to provide developers with a general-purpose computing architecture that runs programs everywhere, yet produces a common state secured by the rules of consensus \cite[p.~31]{Antonopoulos.2018}, Ethereum redefines existing concepts, while also introducing several new ones.

\subsubsection{Accounts}
At its core, the state of Ethereum is composed by objects called \textit{accounts}, each of which has its own 20-byte address and features the following properties \cite[p.~17]{ethereumWhitepaperGitHub}: 

\begin{itemize}
  \item \Gls{nonce}
  \item Current ether balance
  \item Contract code (if present)
  \item Storage (empty by default)
\end{itemize}

Further, two types of accounts are distinguished \cite[p.~17]{ethereumWhitepaperGitHub}:

\begin{description}
	\item[\acp{EOA}]
	\hfill \\
	Accounts created by or for human users of the Ethereum network. This implies the existence of a private key which controls access to the associated funds \cite[p.~13]{Antonopoulos.2018}. Such an account has no code, but can send messages by creating and signing a transaction.
	\item[Contract accounts]
	\hfill \\
	Accounts containing code that executes whenever a message is received from another account \cite[p.~13]{Antonopoulos.2018}. Consequently, they are owned and controlled by the logic of the code stored respectively \cite[p.~57]{Antonopoulos.2018}. This code allows contract accounts to read and write to internal storage and send messages. The latter unlocks additional capabilities such as transferring Ether and creating new or interacting with existing contracts \cite[p.~19]{ethereumWhitepaperGitHub}.
\end{description}

\subsubsection{Messages \& Transactions}
\label{sec:messagesTransactions}
As previously indicated, a transaction is a signed data package that stores a message which originated from an \ac{EOA}. It works as expected from any cryptocurrency (i.e. it results in a transfer of value, if confirmed and non-zero, positive amount was specified) but has been expanded by three additional fields for contract invocation \cite[p.~18]{ethereumWhitepaperGitHub}: 

\begin{AutoMultiColItemize}
  \item recipient
  \item signature (identifies sender)
  \item amount of ether (denoted in Wei \footnote{Smallest unit of currency, i.e. $1\ Ether = 1x10^{18}\ Wei$. Following the International System of Units, Ether's denominations have both a scientific name, as well as a colloquial name that pays homage to the great minds of computing and cryptography \cite[p.~40]{Antonopoulos.2018}.})
  \item \textit{data} (optional)
  \item \textit{start gas} (required)
  \item \textit{gas price} (required)
\end{AutoMultiColItemize}

On the other hand, messages are virtual objects that are never serialized \cite[p.~19]{ethereumWhitepaperGitHub}. This is due to the fact that all messages can be reconstructed by replying the transaction that triggered a contract's code to run and thus, produced the message in question \footnote{Messages are generated whenever a contract uses the \texttt{CALL} upcode \cite[p.~19]{ethereumWhitepaperGitHub}}. More, they only implicitly contain the sender's address and do not allow the gas price to be specified as is explained in the following section.

\subsubsection{Gas}
Whereas Bitcoin's scripting language is constrained to simple \texttt{true/false} evaluation of spending conditions, Ethereum's language is Turing-complete, meaning that it can execute code of arbitrary and unbounded complexity \cite[p.~25]{Antonopoulos.2018}. In turn, this leads to additional security and resource management problems as it cannot be predicted whether a program will terminate or run in infinite loops to effectively cause a Denial-of-Service. To combat this attacking scheme, Ethereum introduces a metering mechanism called \textit{gas} which accounts for every instruction performed and assigns each a predetermined cost in units of gas \footnote{The current fee schedule can be found in \cite[p.~25]{ethereumYellowPaper}.} relative to the degree of computation required or burden imposed from writing to a persistent data store \cite[pp.~32-33]{Antonopoulos.2018}. For simple transactions (i.e. a payment), the amount needed has been fixed at 21k units \cite[p.~153]{Antonopoulos.2018}. 

By requiring transactions to set an upper limit (\texttt{STARTGAS}), execution will deterministically terminate as soon as the gas consumed exceeds the gas supplied \cite[p.~33]{Antonopoulos.2018}. This gas allowance applies to both the transaction itself, as well as all sub-executions triggered through the encapsulated message \cite[p.~19]{ethereumWhitepaperGitHub}. Logically, the total amount to be consumed by invoking a particular method can only be estimated because contracts can evaluate different conditions leading to different execution paths. In any case, \acp{EOA} are only billed for the gas actually used \footnote{Assert-style exceptions consume all gas available \cite[p.~75]{solidityDocs}} \cite[p.~154]{Antonopoulos.2018}. 

Additionally, the \texttt{GASPRICE} field allows an originator to set the exchange rate for each unit of gas (measured in Wei per gas unit). Analogous to other cryptocurrencies, the higher the gas price \footnote{Often, the suggested gas price is calculated as the median across the last several blocks \cite[p.~153]{Antonopoulos.2018}. However, gas prices are predominantly determined by miners and can therefore fluctuate unexpectedly \cite[p.~54]{Antonopoulos.2018}.}, the faster the transaction is likely to confirm. Still, it may also be set to zero and the transaction might even get mined during periods of low demand \cite[p.~153]{Antonopoulos.2018}. 

With these two parameters in place, the definite transaction fee, collected by miners, can be calculated as specified in \autoref{eq:transactionFee} \cite[p.~53]{Antonopoulos.2018} \cite[p.~20]{ethereumWhitepaperGitHub}.

\begin{equation}
\label{eq:transactionFee}
fee = gas\ consumed * gas\ price
\end{equation}

In this sense, gas is the fuel of Ethereum and has been purposefully separated as such to protect the system from Ether's volatility in value \cite[p.~152]{Antonopoulos.2018}. At the same time, developers need to think of incentives for people to use the application since invocation of a smart-contract ultimately incurs monetary costs \cite[p.~4]{blockchainTechnologyGrowth}. 

\subsection{Functioning}
\subsubsection{State Transition Function}
\label{sec:stateTransition}
Like any (distributed) state machine, Ethereum requires a function to transition the current state (\texttt{S}) to the next final state (\texttt{S'}). This function is defined as \texttt{APPLY(S, TX)~->~S'}, where \texttt{TX} represents any unprocessed (i.e. unconfirmed) transaction. Application works as following \cite[p.~20]{ethereumWhitepaperGitHub}:  

\begin{enumerate}
  \item Check if transaction is well formed, contains valid signature and matches nonce
  \item Calculate $\texttt{FEE} = \texttt{STARTGAS} \times \texttt{GASPRICE}$, determine sending address from signature, subtract fee and increment nonce
  \item Set $\texttt{GAS} = \texttt{STARTGAS}$ and take off certain quantity per byte to pay for in transaction
  \item Transfer value to receiving account and run specified contract code if present
  \item If transaction failed due to insufficient funds or out of gas exception, revert all state changes except payment of mining fees
  \item Otherwise, refund remaining gas to sender and add fee to miner's balance
\end{enumerate}

\subsubsection{Code Execution}
Instead of only tracking the state of currency ownership, Ethereum tracks a general-purpose, key-value data store \cite[p.~28]{Antonopoulos.2018}. More complex state transitions (i.e. not a payment) can be achieved by loading the code stored for a specific contract account into memory and running it on an emulated computer called the \ac{EVM} \cite[p.~57]{Antonopoulos.2018}. \ac{EVM} code is written in a low-level, stack-based bytecode language, generated from compiling one of the many high-level languages available \footnote{A curated list of compatible smart-contract languages can be found at \cite{smartContractLanguages}.} (e.g. LLL, Solidity, Vyper) \cite[p.~22]{ethereumWhitepaperGitHub} \cite[p.~29]{Antonopoulos.2018}. 

In general, code execution is an infinite loop that repeatedly carries out the operation at the current program counter until the end of code is reached or an \texttt{ERROR}, \texttt{STOP} or \texttt{RETURN} instruction is detected. During execution in the \ac{EVM}, code may access the value, sender and data of an incoming message, in addition to basic block header data and the global account state. Furthermore, operations have access to three types of space in which to store data \cite[p.~22]{ethereumWhitepaperGitHub}:

\begin{itemize}
  \item stack (follows LIFO-principle with push and pop methods)
  \item memory (infinitely expandable byte array)
  \item storage (persistent key-value store)
\end{itemize}

Lastly, it must be mentioned that the \ac{EVM} is modelled as a completely isolated, sandboxed process preventing access to the network and filesystem \cite[p.~19]{solidityDocs}. This has the negative effect of rendering most traditional APIs useless \cite[p.~46]{Raval.2016}. 

%Solidity represents the most dominant and widely used language \cite[p.~58]{Antonopoulos.2018}.

%Similar to the formal definition of a Turing machine, the full computational state during execution in the \ac{EVM} can be described as a tuple in which \texttt{block\_state} refers to the global state containing all accounts: 
%
%\begin{quotation}
%(\texttt{block\_state, transaction, message, code, memory, stack, pc, gas})
%\end{quotation}

\subsubsection{Block Validation}
Ethereum, by definition, is a system that allows concurrency of operations but enforces a singleton state at each mined block \cite[p.~151]{Antonopoulos.2018}. To ensure that this state (also applies to forks) represents a valid state, the following block validation algorithm must be carried out by each node upon downloading a foreign block \cite[p.~57]{Antonopoulos.2018} \cite[pp.~23]{ethereumWhitepaperGitHub}:

\begin{enumerate}
  \item Check if previous block referenced exists and is valid
  \item Check that timestamp is greater than previous but less than 15 minutes in future
  \item Check that block number, difficulty and various other low-level Ethereum-specific parameters are valid
  \item Check that proof-of-work on block is valid
  \item Set $\texttt{s[0]} =$ state of previous block
  \item Set $\texttt{TX} =$ block transaction list (with n transactions). For each \texttt{i} in \texttt{0...n-1}, set $\texttt{s[i+1] = APPLY(S[i], TX[i])}$. Return an error, if any iteration returns an error (comp. \nameref{sec:stateTransition}) or total gas consumed exceeds the \texttt{GASLIMIT} \footnote{Similar to Bitcoin's block size, the \texttt{GASLIMIT} regulates the maximum number of transactions that can be included within a block \cite{blocksizeControversy} \cite[p.~8]{ethereumYellowPaper}.}.
  \item Set $\texttt{s\_final} = \texttt{s[n]}$ with block reward paid to miner
  \item Verify that merkle tree root of \texttt{s\_final} is equal to root provided in header
\end{enumerate}

This procedure also directly answers the question where contract code will be executed in terms of physical hardware. Namely, on all nodes that download and validate blocks containing transactions whose data field matches one of the methods of the recipient's contract code \cite[p.~24]{ethereumWhitepaperGitHub}.